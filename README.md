# TravelersSocialNetwork 
System Design социальной сети для курса по [System Design](https://balun.courses/courses/system_design)


## Функциональные требования
- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест в виде ТОПа мест по странам и городам;
- общение с другими путешественниками в личных сообщениях;
- просмотр ленты других путешественников.


## Нефункциональные требования
- Число пользователей линейно растет в течение года и достигнет DAU = 10 000 000
- В среднем один пользователь в день выполняет следующие действия:
    - в год пользователь пишет 10 постов - 10 / 365 = 0.03 поста в день
    - оставляет 10 оценок
    - оставляет 5 комментариев
    - подписывается на 3 других путешественника
    - отправляет 100 сообщений
    - просматривает 50 постов
    - просматривает 100 сообщений
- Availability level = 99.95%
- Данные хранятся всегда
- Аудитория только СНГ
- Максимальное число фото, прикрепленных к посту 10
- Максимальный размер описания 1000 символов
- Нельзя подписаться на более, чем 500 других путешественников
- Время загрузки одного поста не должно превышать 1 с, каждой фотографии - 2.5 с  


## Описание сущностей

_Пользователь_ (400 Кб)
- id - 8 Б
- Имя - 40 Б
- Email - 80 Б
- О себе - 4 Кб
- Фото - 400 Кб

_Пост_ (1.2 Мб)
- id - 8 Б
- Название - 40 Б
- Описание - 4 Кб
- Координаты - 4 Б
- id автора - 8 Б
- Массив фото - до 4 Мб, в среднем 3 фото по 400 Кб => 1.2 МБ

_Подписка_ (m2m) (25 Б)
- id - 8 Б
- id подписчика - 8 Б
- id путешественника  - 8 Б

_Лайк_ (m2m) (25 Б)
- id - 8 Б
- id автора - 8 Б
- id поста  - 8 Б

_Комментарий_ (225 Б)
- id - 8 Б
- id поста - 8 Б
- id автора - 8 Б
- Текст - 200 Б

_Сообщение_ (225 Б)
- id - 8 Б
- id поста - 8 Б
- id автора - 8 Б
- Текст - 200 Б


### Рассчёты

#### Capacity and throughput на хранение постов
_Линейный рост от 0 до 10 000 000 DAU равносилен равномерной нагрузке в 5 000 000_

_Количество запросов от одного пользователя в день_ ≈ 50

_Трафик на запись от одного пользователя в день_ = 0.03 * 1.2 Мб = 36 Кб

_Трафик на чтение от одного пользователя в день_ = 50 * 1.2 Mб = 60 Мб

---

RPS = DAU * 50 / 86 400 ≈ 2 900

Write traffix per day = DAU * 36 Кб = 5 000 000 * 36 Кб = 180 Гб

Write traffix per second = 180 Гб / 86 400 c = 0.002 Гб/с = 2 Мб/с

Read traffix per day = DAU * 60 Мб = 5 000 000 * 60 Мб = 300 Тб

Read traffix per second = 300 Тб / 86 400 c = 0.0035 Тб/с = 3.4 Гб/с

Capacity per year = 180 Гб * 365 = 65 700 Гб = 65.7 Тб

---

Capacity = 65.7 Тб * 1.2 = 78.84 Тб ≈ 14 SSD по 6 Тб (учитываем запас в 20%)

При продолжении линейного роста, через год понадобится в 2 раза больше памяти => лучше сразу купить 30 SSD по 6 Тб

Troughput = 3.4 Гб/с
